{% extends 'base.html.twig' %}

{% block title %}Gestion des utilisateurs - Admin{% endblock %}

{% block main %}
	<main class="main-show">
{% include "admin/part/adminNav.html.twig" %}
		<h1>Gestion des utilisateurs</h1>
		<form class="search-bar" method="get" action="{{ path('app_admin_user_index') }}">
			<label for="keywords">Rechercher</label>
			<input type="text" name="keywords" id="keywords" value="{{ keywords ?? '' }}">
			<button type="submit" aria-label="Rechercher">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search-icon lucide-search" role="img" aria-hidden="true"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
			</button>
		</form>
		<div class="table-div">
			<table class="table">
				<thead>
					<tr>
						<th>Id</th>
						<th>Email</th>
						<th>Pseudo</th>
						<th>Rôles</th>
						<th>Créé le</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for user in users %}
						<tr>
							<td>{{ user.id }}</td>
							<td>{{ user.email }}</td>
							<td>{{ user.pseudo }}</td>
							<td>
								<form method="post" action="{{ path('app_admin_user_update_roles', {id: user.id}) }}" class="js-role-form">
									<input type="hidden" name="_token" value="{{ csrf_token('update_roles' ~ user.id) }}">
									{% set currentRole = user.roles[0] ?? 'ROLE_USER' %}
									<select name="role" class="js-role-select">
										<option value="ROLE_USER" {{ currentRole == 'ROLE_USER' ? 'selected' : '' }}>
											Utilisateur
										</option>
										<option value="ROLE_REDACTEUR" {{ currentRole == 'ROLE_REDACTEUR' ? 'selected' : '' }}>
											Rédacteur
										</option>
										<option value="ROLE_ADMIN" {{ currentRole == 'ROLE_ADMIN' ? 'selected' : '' }}>
											Admin
										</option>
									</select>
									<button type="submit" aria-label="Sauvegarder le rôle de {{ user.pseudo }}">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save-icon lucide-save" role="img" aria-hidden="true"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"/><path d="M7 3v4a1 1 0 0 0 1 1h7"/></svg>
									</button>
								</form>
							</td>
							<td>{{ user.createdAt|date('d/m/y H:i') }}</td>
							<td>
								<form method="post" action="{{ path('app_admin_user_delete', {'id': user.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');">
									<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
									<button class="btn" aria-label="Supprimer {{ user.pseudo }}">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e5676e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2" role="img" aria-hidden="true"><path d="M10 11v6"/><path d="M14 11v6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
									</button>
								</form>
							</td>
						</tr>
					{% else %}
						<tr>
							<td colspan="6">Aucun utilisateur trouvé</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</main>
{% endblock %}
